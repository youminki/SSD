# 프로세스 & 스레드

<br>

> **프로세스** : 메모리상에서 실행 중인 프로그램
>
> **스레드** : 프로세스 안에서 실행되는 여러 흐름 단위

<br>

기본적으로 프로세스마다 최소 1개의 스레드(메인 스레드)를 소유한다.

<br>

![img](https://camo.githubusercontent.com/3dc4ad61f03160c310a855a4bd68a9f2a2c9a4c7/68747470733a2f2f74312e6461756d63646e2e6e65742f6366696c652f746973746f72792f393938383931343635433637433330363036)

프로세스는 각각 별도의 주소 공간을 할당받는다. (독립적)

- Code : 코드 자체를 구성하는 메모리 영역 (프로그램 명령)

- Data : 전역 변수, 정적 변수, 배열 등
  - 초기화된 데이터는 Data 영역에 저장
  - 초기화되지 않은 데이터는 BSS 영역에 저장

- Heap : 동적 할당 시 사용 (new(), malloc() 등)

- Stack : 지역 변수, 매개 변수, 리턴 값 (임시 메모리 영역)

<br>

스레드는 Stack만 따로 할당받고 나머지 영역은 공유한다.

- 스레드는 독립적인 동작을 수행하기 위해 존재 = 독립적으로 함수를 호출할 수 있어야 함
- 함수의 매개 변수, 지역 변수 등을 저장하는 Stack 영역은 독립적으로 할당받아야 함

<br>

하나의 프로세스가 생성될 때, 기본적으로 하나의 스레드가 같이 생성된다.

<br>

**프로세스는 자신만의 고유 공간 및 자원을 할당받아 사용**하는 데 반해,

**스레드는 다른 스레드와 공간 및 자원을 공유하면서 사용**하는 차이가 존재한다.

<br>

##### 멀티프로세스

> 하나의 프로그램을 여러 개의 프로세스로 구성하여 각 프로세스가 병렬적으로 작업을 처리하도록 하는 것

<br>

**장점** : 안전성 (메모리 침범 문제를 OS 차원에서 해결)

**단점** : 각각 독립된 메모리를 갖고 있어 작업량이 많을수록 오버헤드 발생, Context Switching으로 인한 성능 저하

<br>

***Context Switching* 이란?**

> 프로세스의 상태 정보를 저장하고 복원하는 일련의 과정
> - 동작 중인 프로세스가 대기하면서 해당 프로세스 상태를 보관
> - 대기하고 있던 다음 순번의 프로세스가 동작하면서 이전에 보관했던 프로세스 상태를 복구
>
> 문제점: 프로세스는 독립된 메모리 영역을 할당받으므로, 캐시 메모리 초기화와 같은 무거운 작업이 진행되면 오버헤드가 발생할 수 있음

<br>

##### 멀티스레드

> 하나의 프로그램을 여러 개의 스레드로 구성하여 각 스레드가 하나의 작업을 처리하도록 하는 것

<br>

스레드들이 공유 메모리를 통해 다수의 작업을 동시에 처리하도록 해 준다.

<br>

**장점** : 독립적인 프로세스에 비해 공유 메모리만큼의 시간과 자원 손실 감소, 전역 변수와 정적 변수 공유 가능

**단점** : 안전성 (공유 메모리를 갖기 때문에 하나의 스레드가 데이터 공간을 망가뜨리면, 모든 스레드 작동 불능)

<br>

멀티스레드의 안전성에 대한 단점은 Critical Section 기법을 통해 대비한다.

> 하나의 스레드가 공유 데이터값을 변경하는 시점에 다른 스레드가 그 값을 읽으려 할 때 발생하는 문제를 해결하기 위한 동기화 과정
>
> ```
> 상호 배제, 진행, 한정된 대기를 충족해야 함
> ```
